<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=koi8-r">


<TITLE>Autoconf - История Autoconf</TITLE>
</HEAD>
<body><b><a href="http://www.opennet.ru/docs/">Архив документации OpenNet.ru</a> / 
Раздел "<a href="http://www.opennet.ru/docs/124.shtml">Программирование, языки</a>" /
<a href="index.html">Индекс</a>
</b>
<hr noshade size=1>

Go to the <A HREF="autoconf-ru_1.html">first</A>, <A HREF="autoconf-ru_13.html">previous</A>, <A HREF="autoconf-ru_15.html">next</A>, <A HREF="autoconf-ru_19.html">last</A> section, <A HREF="autoconf-ru_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC103" HREF="autoconf-ru_toc.html#TOC103">История Autoconf</A></H1>
<P>
@anchor{History}


<P>
Вы спросите, зачем вообще Autoconf был написан?  Как он оказался там,
где он сейчас есть?  Почему он выглядит подобно плевку гориллы? Если вы
не интересуетесь такими вопросами, то в этой главе ничего полезного для
вас нет, и вы можете спокойно пропустить ее.  Но если вам
<EM>действительно</EM> интересно, то я пролью немного света....




<H2><A NAME="SEC104" HREF="autoconf-ru_toc.html#TOC104">Бытие</A></H2>

<P>
В июне 1991 года я сопровождал много утилит GNU для Free Software
Foundation. По мере того, как они переносились на все большее количество
платформ, количество ключей <SAMP>`-D'</SAMP>, которое пользователю надо было
выбрать в <TT>`Makefile'</TT> (около 20), становилось обременительным.
Особенно для меня--- я тестировал каждую новую версию на различных
платформах. Так что я написал для пакета fileutils небольшой скрипт на
языке командного процессора для определения некоторых правильных
настроек, и я выпустил его как часть пакета fileutils 2.0. Этот скрипт
<CODE>configure</CODE> работал достаточно хорошо, так что в следующем месяце я
вручную адаптировал его для создания подобных скриптов <CODE>configure</CODE>
для нескольких других пакетов утилит GNU. Brian Berliner также
адаптировал один из моих скриптов к своей системе контроля версий CVS.


<P>
Позже, тем же летом, я узнал, что Richard Stallman и Richard Pixley
разработали аналогичные скрипты для использования в наборе утилит
компиляции GNU; так что я адаптировал мои скрипты <CODE>configure</CODE> для
поддержки развивающегося интерфейса их скриптов: использование файлов
<TT>`Makefile.in'</TT> как шаблонов; добавление <SAMP>`+srcdir'</SAMP>, первого
ключа (из многих); и создание файлов <TT>`config.status'</TT>.




<H2><A NAME="SEC105" HREF="autoconf-ru_toc.html#TOC105">Исход</A></H2>

<P>
По мере получения ответов от пользователей я добавил много улучшений,
используя Emacs для поиска и замены, вырезания и вставки, одних и тех же 
изменений в каждом из скриптов. По мере того, как все большее количество 
утилит GNU были адаптированы для использования скриптов
<CODE>configure</CODE>, ручное обновление становилось все более неудобно.
Rich Murphey, сопровождавший
графические утилиты GNU, послал мне письмо, в котором писал, что скрипты
<CODE>configure</CODE> работают очень хорошо, и спрашивал, нету ли у меня
утилиты для их генерации, и могу ли я послать ее ему. Нет, я думал, но я
должен был! Так, что я начал работать над тем, как создавать эти
файлы. Так началось путешествие от рабства написанных вручную скриптов
<CODE>configure</CODE> к изобилию и легкости Autoconf.


<P>
Пакет Cygnus <CODE>configure</CODE>, который был разработан примерно в то же
время, управлялся таблицей; он предназначался в основном для работы с
небольшим количеством типов систем и небольшим количеством возможностей, 
которые по большей части нельзя было автоматически определить (например, 
детали формата объектных файлов).
Автоматическая система настройки, которую Brian Fox разработал
для Bash, использовала аналогичный подход.  Для общего пользования, мне
кажется безнадежной попытка сопровождать постоянно обновляемую базу
данных возможностей каждого из вариантов каждой операционной системы.
Легче и надежнее будет проверять большинство свойств на лету---
особенно на гибридных системах, которые люди изменяли локально, или на
которых были установлены заплатки от производителя.


<P>
Я рассматривал архитектуру, сходную с используемой в Cygnus
<CODE>configure</CODE>, где имеется один скрипт <CODE>configure</CODE>, который при
запуске считывает части <TT>`configure.in'</TT>. Но я не хотел
распространять с каждым пакетом тесты для всех возможностей, так что я пришел к
решению иметь разные скрипты <CODE>configure</CODE>, созданные из
<TT>`configure.in'</TT> с помощью препроцессора.  Этот подход также
представлял больший контроль и большую гибкость.


<P>
Я также ознакомился с использованием пакета Metaconfig, созданного Larry
Wall, Harlan Stenn и Raphael Manfredi, но я решил не использовать его по
нескольким причинам. Создаваемые с его помощью скрипты <CODE>Configure</CODE>
являются интерактивными, что я нашел достаточно неудобным; мне не
понравился способ, каким он проверял некоторые возможности (такие как
наличие библиотечных функций); я не знал, сопровождался ли он тогда все
еще, а скрипты <CODE>Configure</CODE>, которые я рассматривал, не
работали на многих современных системах (таких как System V R4 и NeXT);
у него не было достаточной гибкости в реакции на наличие или отсутствие
какой-либо возможности; я нашел его трудным в освоении; он был слишком
большим и сложным для моих нужд (я не осознавал тогда, как сильно
придется развить Autoconf).


<P>
Я рассматривал использование языка Perl для создания моих скриптов
<CODE>configure</CODE>, но решил, что <CODE>m4</CODE> лучше для выполнения простых
текстовых подстановок: это получается проще, поскольку операция вывода
подразумевается по умолчанию.  Плюс к тому, каждый пользователь уже имеет его в своей
системе. (В начале я не полагался на расширения GNU для <CODE>m4</CODE>).
Несколько моих друзей в университете штата Maryland создавали надстройки 
на <CODE>m4</CODE> для разных программ, включая <CODE>tvtwm</CODE>, и я был
заинтересован в изучении нового языка.




<H2><A NAME="SEC106" HREF="autoconf-ru_toc.html#TOC106">Левит</A></H2>

<P>
Поскольку мои скрипты <CODE>configure</CODE> определяли возможности системы
автоматически, без интерактивного взаимодействия с пользователем, я
решил назвать программу, которая создавала эти скрипты именем
Autoconfig. Но с добавлением номера версии, это имя было слишком длинным
для старых систем UNIX, так что я укоротил имя до Autoconf.


<P>
Осенью 1991 я собрал группу товарищей, чтобы начать поиски Чаши Грааля
Переносимости (эээ, ну, то есть, чтобы они тестировали альфа-версии).
Они предоставляли мне обратную связь, а я занимался инкапсуляцией
кусочков моих вручную написанных скриптов в макросы <CODE>m4</CODE>, добавлял
возможности и улучшал технологию проверок.  Среди тестеров особенно
выделялись:
Pinard, кто выдвинул идею сделать <TT>`autoconf'</TT> скриптом командного
процессора, который запускал бы <CODE>m4</CODE> и проверял бы, чтобы все
макросы были обработаны; Richard Pixley, кто предложил для получения более точных
результатов запускать компилятор вместо поиска заголовочных файлов и
символов по файловой системе; Karl Berry, который использовал Autoconf для
настройки TeX и добавил индекс макросов в документацию; а
также Ian Taylor, который добавил поддержку создания заголовочного файла
C как альтернативу помещения ключей <SAMP>`-D'</SAMP> в <TT>`Makefile'</TT>, так что
он смог использовать Autoconf для пакета UUCP.  Люди, тестировавшие
альфа-версии, бодро изменяли свои файлы снова и снова, поскольку имена и
соглашения о вызовах изменялись от версии к версии Autoconf. Они также
предоставили мне множество специфических проверок, отличных идей и
исправленных ошибок.




<H2><A NAME="SEC107" HREF="autoconf-ru_toc.html#TOC107">Числа</A></H2>

<P>
В июле 1992, после месяцев тестирований альфа-версий, я выпустил
Autoconf 1.0, и преобразовал много утилит GNU для его использования. Я
был очень удивлен положительной реакцией на выпуск пакета. Так много
людей стало использовать его, так что я не смог отслеживать их, включая
людей, работающих над программным обеспечением, которое не является
частью проекта GNU (например, TCL, FSP и Kerberos V5).  Autoconf
продолжал быстро развиваться, поскольку множество людей, использующих
<CODE>configure</CODE>, писали мне о проблемах, с которыми встретились.


<P>
Autoconf превратился в хороший тест реализаций <CODE>m4</CODE>. UNIX <CODE>m4</CODE>
начали выдавать дампы памяти, из-за длины макросов, определяемых
Autoconf; несколько ошибок было найдено в GNU <CODE>m4</CODE>.  В
конечном счете мы осознали, что нам необходимо использовать некоторые
возможности, которые имеются только в GNU <CODE>m4</CODE>.  В частности, версия
4.3BSD <CODE>m4</CODE> имела слишком маленький набор встроенных макросов; версия для
System V немного лучше, но все равно не предоставляла всех нужных нам
возможностей.


<P>
Происходила дальнейшая разработка по мере того, как люди Autoconf в
более жесткие условия (и использовали так, как я не ожидал). Karl Berry
добавил проверки для X11. David Zuhn сделал поддержку C++.
Pinard сделал диагностику неправильных аргументов. Jim Blandy
использовал пакет для настройки GNU Emacs, закладывая фундамент для
некоторых последующих улучшений.  Roland McGrath, использовавший пакет для
библиотеки GNU C, написал скрипт <CODE>autoheader</CODE> для автоматизации
создания шаблонов заголовочных файлов C, а также добавил ключ
<SAMP>`--verbose'</SAMP> к <CODE>configure</CODE>. Noah Friedman добавил поддержку
ключа <SAMP>`--macrodir'</SAMP> и переменной среды <CODE>AC_MACRODIR</CODE>. (Он также
ввел в употребление термин <EM>autoconfiscate</EM>, который означает "адаптировать
программное обеспечение для использования Autoconf".)  Roland и Noah
улучшили экранирование специальных символов в макросе <CODE>AC_DEFINE</CODE> и исправили множество
ошибок, особенно когда я пресытился проблемами с переносимостью
с февраля по июнь 1993.




<H2><A NAME="SEC108" HREF="autoconf-ru_toc.html#TOC108">Второзаконие</A></H2>

<P>
Постепенно накапливался длинный список важных возможностей, которыми
хотелось бы пользоваться, а несколько лет, в течение которых множество
людей накладывали на Autoconf заплатки, привели к накоплению всякого
хлама, который невозможно было вычистить.  В
апреле 1994, в процессе работы на Cygnus Support, я начал полный
пересмотр Autoconf.  Я добавил большинство возможностей, которые
отсутствовали в Autoconf, но присутствовали в Cygnus <CODE>configure</CODE> -- в
основном адаптируя некоторые части Cygnus <CODE>configure</CODE> с помощью
David Zuhn и Ken Raeburn.  Эти возможности включают поддержку использования
<TT>`config.sub'</TT>, <TT>`config.guess'</TT>, <SAMP>`--host'</SAMP> и <SAMP>`--target'</SAMP>;
создание ссылок на файлы; и запуск скриптов <CODE>configure</CODE> в
подкаталогах. Добавление этих возможностей позволило Ken'у преобразовать для использования
Autoconf GNU <CODE>as</CODE>, а Rob'у Savoye -- DejaGNU.


<P>
Я добавил множество возможностей, о которых просили разные люди.  Многие
просили, чтобы скрипты <CODE>configure</CODE> могли использовать результаты
проверок при последующих запусках, потому что (особенно при настройке
большого дерева исходных текстов, как, например, делает Cygnus) они были
ужасающе медленны.  Mike Haertel предложил добавить специфические для
машин скрипты инициализации. Люди, распространяющие программное
обеспечение, которое будет работать на MS-DOS, просили предоставить
возможность переопределения расширений <TT>`.in'</TT> в именах файлов, из-за 
чего появлялись имена типа <TT>`config.h.in'</TT>, содержащие две точки.
Jim Avera сделал обширное исследование проблем с экранированием кавычек
в макросах <CODE>AC_DEFINE</CODE> и <CODE>AC_SUBST</CODE>; его
проницательность привела к значительным улучшениям.  Richard Stallman
просил, чтобы вывод компилятора посылался в файл <TT>`config.log'</TT>
вместо <TT>`/dev/null'</TT>, чтобы помочь людям отлаживать скрипты
<CODE>configure</CODE> для Emacs.


<P>
Я сделал некоторые изменения, потому что был недоволен качеством
программы.  Я сделал сообщения о результатах проверок менее
двусмысленными, и сделал так, чтобы эти сообщения всегда выдавались.
Я подправил имена
макросов и подправил несовместимости со стандартами кодирования. Я
добавил некоторые вспомогательные утилиты, которые были разработаны,
чтобы помочь в адаптации пакетов для использования
Autoconf. С помощью
Pinard, я сделал так, чтобы макросы не прерывали другие сообщения других
макросов. (Эта возможность вывела на чистую воду некоторые узкие места в
производительности GNU <CODE>m4</CODE>, которые были поспешно исправлены!) Я
реорганизовал документацию, чтобы она вращалась вокруг тех самых
проблем, которые люди и хотели решить.  И я начал создавать набор
тестов, поскольку опыт показал, что Autoconf имеет ярко выраженную
тенденцию к регрессу при изменениях.


<P>
Опять же, несколько альфа-тестеров дали бесценную
информацию, особенно
Pinard, Jim Meyering, Karl Berry, Rob Savoye, Ken Raeburn и Mark Eichin.


<P>
В конце концов, версия 2.0 была готова. И было много радости по этому
поводу. (И у меня опять появилось свободное время.  Кажется.  Нет, я
уверен!)


<P><HR><P>
Go to the <A HREF="autoconf-ru_1.html">first</A>, <A HREF="autoconf-ru_13.html">previous</A>, <A HREF="autoconf-ru_15.html">next</A>, <A HREF="autoconf-ru_19.html">last</A> section, <A HREF="autoconf-ru_toc.html">table of contents</A>.
<hr noshade size=1>
<b><a href="http://www.opennet.ru/docs/">Архив документации на OpenNet.ru</a>
</BODY>
</HTML>
